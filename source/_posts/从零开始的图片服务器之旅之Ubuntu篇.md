title: 从零开始的图片服务器之旅—Ubuntu篇
date: 2018/01/16  20:46:25
tags: 潜龙在渊
categories: 小试牛刀
---
### 常规操作
```
$ sudo apt-get update
```
<!--more-->
### 安装vsftpd
```
$ sudo apt-get install vsftpd
```
#### 在home目录下创建静态资源文件夹images

```
$ sudo mkdir -p /home/ftpuser/www/images
```
#### 在ftpuser目录下新建用户

```
$ sudo useradd -d /home/ftpuser -s /bin/bash ftpuser
```
#### 设置ftpuser用户密码

```
$ sudo passwd ftpuser
```
### FTP相关命令
```
#启动ftp服务
$ sudo service vsftpd start
# 查看ftp服务状态
$ sudo service vsftpd status 
# 重启ftp服务
$ sudo service vsftpd restart
# 关闭ftp服务
$ sudo service vsftpd stop
```
在虚拟机浏览器中输入ftp://本机ip地址或localhost，回车后会弹出输入框，根据提示输入用户名和密码
备注：我的用户名是：ftpuser，密码是自己设置的

#### 修改vsftpd.conf配置文件
```
$ sudo gedit /etc/vsftpd.conf
匿名登陆，注释掉或者改为NO
#anonymous_enable=YES
允许本地用户登陆
local_enable=YES
可写,注意删除#
write_enable=YES
```
#### 更改文件夹读写权限
```
$ sudo chown -R  ftpuser /home/ftpuser
```
#### 关闭防火墙
```
$ sudo ufw disable
```

使用工具进行文件上传，如：FileZilla、FlashFXP
### 安装nginx
```
$ sudo apt-get install nginx
```
简单介绍：
ubuntu安装完nginx之后的文件结构大致为：
```
1. 配置文件: /etc/nginx
2. 虚拟主机：/etc/nginx/sites-available
3. 启动程序文件：/usr/sbin/nginx
4. 日志：/var/log/nginx，分别是access.log和error.log
5. 启动脚本：/etc/init.d
6. 默认的虚拟主机的目录：/usr/share/nginx/html
```
#### 启动nginx
```
$ sudo /etc/init.d/nginx start
```
#### 配置nginx静态资源库
编辑default配置文件:
```
$ sudo gedit /etc/nginx/sites-available/default
```
修改内容如下(注意写有中文的地方即可)：
```
server {
    #端口可根据自己的需要更改，我的修改为8888
    listen 8888 default_server;
    listen [::]:888 default_server;

    # SSL configuration
    #
    # listen 443 ssl default_server;
    # listen [::]:443 ssl default_server;
    #
    # Note: You should disable gzip for SSL traffic.
    # See: https://bugs.debian.org/773332
    #
    # Read up on ssl_ciphers to ensure a secure configuration.
    # See: https://bugs.debian.org/765782
    #
    # Self signed certs generated by the ssl-cert package
    # Don't use them in a production server!
    #
    # include snippets/snakeoil.conf;

    root /var/www/html;

    # Add index.php to the list if you are using PHP
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {
        # First attempt to serve request as file, then
        # as directory, then fall back to displaying a 404.
        try_files $uri $uri/ =404;
    }

   #配置图片根目录
   #在server节点里添加url映射，加一个location

   location /images {
            root   /home/ftpuser/www/;
            autoindex on;
}
```
#### 编辑nginx.conf配置文件
```
$ sudo gedit /etc/nginx/nginx.conf
```
默认配置有以下内容，将第一行 user: www-data; 修改为： user ftpuser; 目的是便于上传的文件nginx有权限访问
```
user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 768;
    # multi_accept on;
}
```
#### 重启nginx
```
$ sudo /etc/init.d/nginx restart
```
#### 浏览器访问路径
```
http://192.168.169.129:8888/images
```
IP地址和端口根据自己的虚拟机和配置填写